<!DOCTYPE html>
<html lang="en-us">
    <head>
		<title>The Perfect Chocolate Chip Cookie</title>
		<meta charset="utf-8">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Fascinate|Open+Sans" rel="stylesheet">
		<script src="/jscript/d3v4+jetpack.js"></script>
		<script src="/jscript/graph-scroll.js"></script>
		<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="/jscript/analyticstracking.js"></script>
		<link rel="stylesheet" href="/css/reset.css">
		<link rel="stylesheet" href="cookie.css">
   </head>
	<body>
		<div id="header">
			<h1>The Perfect Chocolate Chip Cookie</h1>
		</div>
		<div id="contentColumn">
			<p id="intro">The quest to find the definitive version of America's favorite snack from every recipe the web has to offer.</p>
			<div id="origRecipe">
				<div class="inset">
					<h2>The Toll House Cookie</h2>
					<ul>
						<li>1 1/2 cups of shortening</li>
						<li>1 1/8 cups of sugar</li>
						<li>1 1/8 cups of brown sugar</li>
						<li>3 eggs</li>
						<li>1 1/2 teaspoon of salt</li>
						<li>3 1/8 cups of flour</li>
						<li>1 1/2 teaspoon of hot water</li>
						<li>1 1/2 teaspoon of baking soda</li>
						<li>1 1/2 teaspoon of vanilla</li>
						<li>Chocolate chips (and walnuts)</li>
					</ul>
					<p>Bake at 350 degrees for 12-13 minutes</p>
				</div>
				<p class="caption">Is the original recipe still the best?</p>
			</div>
			<p>The Chocolate Chip Cookie is a classic. The King of Cookies. A timeless masterpiece and the favourite of America’s foremost cookie connoisseur: Cookie Monster.</p>
			<p>It was invented in 1938 by Ruth Graves Wakefield and named the Toll House Cookie after the inn she owned. The original recipe contains just 10 ingredients of which fat, sugar, flour, eggs and, of course, chocolate chips are the staples.</p>
			<p>Pretty simple. However in the intervening 79 years the chefs of the world have not been satisfied to leave a culinary classic alone. In fact so many have tried to modify and improve the humble CCC that we are now in the regrettable situation where a search on <a href="http://www.yummly.com" target="yummly">yummly.com</a> for “Chocolate Chip Cookie” returns an astonishing 29,921 recipes.</p>
			<p>For the home cookie maker it leaves an obvious but impossible to answer question: Which of these recipes is the best?</p>
			<p><a href="http://www.yummly.uk/#recipe/Perfect-Chocolate-Chip-Cookies-1688970" target="yummly">“Perfect Chocolate Chip Cookies”</a> from The Guardian website is the most popular with over 3000 “Yums” but has a below-perfect average rating of 4.1/5 from 7 reviews.</p>
			<p><a href="http://www.yummly.uk/#recipe/Chocolate-Chip-Cookies-1759719" target="yummly">"Chocolate Chip Cookies”</a> from Manu’s Menu has a perfect rating of 5/5 but from only 3 reviews and boasts a paltry 230 “Yums”.</p>
			<p>And what about the rest? Has anyone ever scrolled all the way down to recipe 29,921 and tried it? Perhaps it is the greatest recipe ever formulated. Perhaps it renders cookies of such breathtaking deliciousness that after one bite Otis Spunkmeyer would hang up his floppy white hat and denounce his life’s work as a meaningless sham. We don’t know. Even trying to scroll that far would wear the tip of your finger to the bone. How can we ever be sure which is the definitive Chocolate Chip Cookie recipe?</p>
			<p>We can’t. But with such a large dataset we can at least submit ourselves to the wisdom of the crowd. We will gratefully utilise these millions of hours of kitchen experimentation by thousands of nameless internet chefs. We will take all these recipes, mix them together, stir vigorously and bake in the pre-warmed oven of data analysis until we have the scientifically(-ish) proven <strong>greatest ever chocolate chip cookie recipe</strong>. The pinnacle of milk-dunking perfection.</p>
			<p>Or failing that the mathematically established “most average”.</p>
			<img src="cookie-break.png" class="break" />
			<p>Before we dive into this ocean of recipes are we sure that all 30,000 really do produce something Ruth Wakefield would recognise as a Toll House Cookie? Or are some merely imposters trading off the good name of the Chocolate Chip Cookie? And how are we going to separate the genuine article from the less-than-blue-chip cookie?</p>
			<p>Its time to introduce a a couple of ground rules:</p>
			<div id="filterContainer" class="container">
				<div id="filterChart" class="scrollChart">
					<div class="inset">
						<h2>Cooking Techniques</h2>
						<svg id="filterSVG" width="560" height="410"></svg>
					</div>
				</div>
				<div id="filterSections" class="scrollSections">
					<div>
						<p><strong>1. The cookie must be baked</strong></p>
						<p>Yummly allows us to filter on "cooking technique" and remarkably when we choose "baked" a huge 12,000 recipes are deselected. That is an awful lot of cookies that are browned, microwaved, boiled or even braised. But the original recipe says "bake" and that is good enough for us. There won't be any marinating involved with our cookie.</p>
					</div>
					<div>
						<p><strong>2. The cookie must contain chocolate chips</strong></p>
						<p>These are tempestuous times but if there is one thing I am still absolutely certain of it is this: the ultimate Chocolate Chip Cookie contains chocolate chips. Not M&Ms. Not broken Oreos. Not Toblerone, Mars, Hershey's Kisses, Andes Cr&egrave;me de Menthe Thins or any of the other imposters some 2,856 recipes would substitute. Equally we won't be making a chocolate chip cookie that doesn't contain any chocolate. These recipes have embarrassed themselves and we won't be wasting any more time on them.</p>
					</div>
					<div>
						<p><strong>Interesting filter fact:</strong> We aren’t going to cater for people with food intolerances but its reassuring to know that even if you are allergic to dairy, egg, gluten, peanuts, seafood, sesame, soy, sulfites, tree nuts AND wheat there are still 44 recipes you can use.</p>
					</div>
				</div>
			</div>
			<img src="cookie-break.png" class="break" />
			

			<div id="ingredientsContainer" class="container">
				<div id="ingredientsChart" class="scrollChart">
					<div class="inset" id="ingredientsGraph">
						<h2 id="ingredientsTitle">Top Ingredients</h2>
						<svg id="ingredientsSVG" width="560" height="600"></svg>
					</div>
				</div>
				<div id='ingredientsSections' class="scrollSections">
					<div>
						<p>So we've discovered that some chefs are going dangerously off-piste with their interpretation of the chocolate chip cookie but is their meddling confined just to the chocolate component are are they taking liberties with other ingredients as well?</p>
						<p>The table shows the top 20 ingredients by occurrence in our remaining recipes. Reassuringly the most common ingredients match the original recipe pretty closely. Most versions agree on the need for sugar, flour, butter, eggs, vanilla, salt and some sort of baking powder/bicarbonate of soda.</p>
						<p>Beyond these staples even the most popular ingredient appears in less than 20% of the recipes. Oats, coconut and cocoa powder have plenty of fans but they feature in only a minority of recipes. It seems obvious that our ultimate cookie should consist of only these top 8 ingredients. But that would mean ignoring... </p>
						<p><strong>The Walnut Dilemma</strong></p>
						<p>Walnuts sneak into the original Toll House Cookie recipe almost as an afterthought. Included in parentheses after chocolate chips the recipe gives no indication of the amount to add or even their ratio to the chips. What does this mean for our quest? Should we include them? Should we include recipes that feature different nuts? This is a big decision but I'm going to allow them. We've been strict on the cooking method and different chocolate types so I'm cutting some slack on the nuts. But only the nuts. (This is not a green light to sneak in raisins or, God forbid, cranberries.)</p>
					</div>
					<div>
						<p>Having mentioned raisins and cranberries lets take a look at some of the other more unusual ingredients that are being used in so-called chocolate chip cookies. It goes without saying that we won't be using any of these but as with other dangers that face our society its important to be aware of the threats that are out there. Forewarned is forearmed and all that.</p>

						<p>It gives me no pleasure to report that people are adding some pretty strange things to their cookies. These include fruits (strawberries, raspberries, morello cherries) and vegetables (sweet potatoes, garbanzo beans and pumpkin) which should be rejected for trying to sneak healthy eating into a cookie.</p>
						<p>Meanwhile popcorn and potato chips have no place in a cookie because they are already a snack. If we start indiscriminately mashing our snacks into each other where does it end? Jerky donuts? BBQ smoked Twinkies? Chocolate coated Pringles?</p>
						<p>And if you know anyone who is adding jalapeno chiles, rosemary leaves or tea bags to their cookies please get them the assistance they need. Cries for help don't come louder.</p>
					</div>
					<div>&nbsp;</div>
				</div>
			</div>
			<p>[Writing continues with analysis of different amounts of types of key ingredients. E.g. Amount of brown/white sugar used plotted on scatter graph with size of point to indicate user rating/number of 'yums' for that recipe. Idea to not only show distribution  but also how that correlates to 'deliciousness' (as judged from recipe ratings)].</p>

			<p>[Results of analysis will result in different recipes for comparison, e.g.:]</p>
			<p>[
				<strong>Average</strong> - Mean amount/type of every key ingredient. So recipe may consist of:<ul>
				<li>- 1.56 cups white flour/1.34 cups wholemeal flour</li>
				<li>- 0.32 cups butter/0.26 cups margerine/0.14 cups shortening</li>
				<li>- 2.45 eggs</li>
				<li>- 0.22 cups milk chocolate chips/0.14 cups dark chocolate chips/0.08 white chocolate chips</li>
				<li>- Etc for 8 identified key ingredients...</li>
			</ul>
			Bake at 327 degrees for 12 minutes 18 seconds]</p>
			<p>[
				<strong>Single ingredients</strong> - Most popular type of each ingredient is used but amounts are averaged:<ul>
				<li>- 2.92 cups <strong>white</strong> flour</li>
				<li>- 1.62 cups <strong>butter</strong></li>
				<li>- 2.45 eggs</li>
				<li>- 0.56 cups <strong>milk</strong> chocolate chips</li>
			</ul>
			Bake at 327 degrees for 12 minutes 18 seconds]</p>
			<p>[
				<strong>Every possible ingredient</strong> - Mean of <strong>every</strong> ingredient from every recipe (that equates to more than 'trace' amounts):<ul>
				<li>- 1.56 cups white flour/1.34 cups wholemeal flour</li>
				<li>- 0.32 cups butter/0.26 cups margerine/0.14 cups shortening</li>
				<li>- 2.45 eggs</li>
				<li>- 0.22 cups milk chocolate chips/0.14 cups dark chocolate chips/0.08 white chocolate chips</li>
				<li>- 0.2 cups oats</li>
				<li>- 7 grams M&Ms</li>
				<li>- 1 teaspoon peanut butter</li>
				<li>- 1/2 teaspoon pecans</li>
				<li>- 1 teaspoon vanilla essence</li>
				<li>- 1 teaspoon Guiness </li>
				<li>- Etc as practicality allows...</li>
				</ul>
			]</p>

			<p>[Bake these recipes and compare them with "benchmark" recipes: original Toll House cookie, Best rated Yummly recipe, most saved Yummly recipe, etc]</p>

			<p>[Find willing volunteers to eat and judge cookies. Present definitive results.]</p>

			<p> [Eat all surplus cookies. Fall into excess cookie induced coma. Finally wake to never eat another cookie again. Violently react to even the mention of cookies or the sound of cookie monster's voice.]</p>

	
		<script>
			var scroll = d3.graphScroll()
				.container(d3.select('#ingredientsContainer'))
				.graph(d3.select('#ingredientsChart'))
				.sections(d3.selectAll('#ingredientsSections > div'))
				.on('active', function(i){
					console.log(i + 'th section active');
					if(i==1){
						updateData('data/unusualIngredients.json');
					}else if(i==0){
						updateData('data/topIngredients.json');
					}
				})
			;



			var svg = d3.select("#ingredientsSVG"),
				margin = {top: 20, right: 20, bottom: 0, left: 100},
    			width = +svg.attr("width") - margin.left - margin.right,
    			height = +svg.attr("height") - margin.top - margin.bottom
    		;
    		
    		var x = d3.scaleLinear().range([0, width]);
			var y = d3.scaleBand().range([height, 0]);
			
			var xAxis = d3.axisTop(x).ticks(10).tickFormat(function(d) { return d; }).tickSizeInner([-height]);
			var yAxis = d3.axisLeft(y);

			var g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");


			function drawChart(dataset){
				d3.json(dataset, function(error, data) {
					if (error) throw error;
					data.sort(function(a, b) { return a.number - b.number; });

					x.domain([0, d3.max(data, function(d) { return d.number; })]);
					y.domain(data.map(function(d) { return d.ingredient; })).padding(0.4);

					g.append("g")
						.attr("class", "x axis")
						.attr("transform", "translate(0,0)")
						.call(xAxis)
					;
					g.append("g")
						.attr("class", "y axis")
						.call(yAxis)
					;
					var bar = g.selectAll(".bar")
						.data(data, function(d) { return d.ingredient; })
						.enter().append("rect")
						.attr("class", "bar")
						.attr("x", 0)
						.attr("height", y.bandwidth())
						.attr("y", function(d) { return y(d.ingredient); })
						.attr("width", function(d) { return x(d.number); })
					;
				});  
			}

			function updateData(dataset){
				d3.json(dataset, function(error, data) {
					data.sort(function(a, b) { return a.number - b.number; });

					x.domain([0, d3.max(data, function(d) { return d.number; })]);
					y.domain(data.map(function(d) { return d.ingredient; })).padding(0.4);

					var svg = d3.select("body").transition();

					svg.select(".x.axis")
						.duration(750)
						.call(xAxis)
					;

					svg.select(".y.axis")
						.duration(750)
						.call(yAxis)
					;
					if(dataset=="data/unusualIngredients.json"){
						svg.select("#ingredientsTitle")
							.delay(750)
							.text("Unusual Ingredients")
						;
					}else{
						svg.select("#ingredientsTitle")
							.delay(750)
							.text("Top Ingredients")
						;
					}
					var bar = g.selectAll(".bar")
						.data(data, function(d) { return d.ingredient; })
					;
					bar
						.enter()
						.append("rect")
						.attr("class", "bar")
						.attr("x", 0)
						.attr("height", y.bandwidth())
						.attr("y", function(d) { return y(d.ingredient); })
						.attr("width", function(d) { return x(d.number); })
					;
					bar.exit().remove();
					
				});
			}

   			drawChart("data/topIngredients.json");

			// var stack = d3.stack();

			var filterScroll = d3.graphScroll()
				.container(d3.select('#filterContainer'))
				.graph(d3.select('#filterChart'))
				.sections(d3.selectAll('#filterSections > div'))
				.on('active', function(i){
					updateFilterChart(i);
				})
			;

			var filterWidth = 560;
			var filterHeight = 410;

			function drawFilterChart(){
				runningTotal = 0;
				scale = 1/90;
				runningTotal2 = 0;
				scale2 = 1/45;
				count = 0;


				d3.json("data/technique.json", function(data) {
					data.techniques.forEach(function(d) {
						d.offset = runningTotal;
						d.barheight = Math.max(2,Math.round(d.number*scale));
						runningTotal += d.barheight;
						runningTotal2 = 0;
						runningTotal3 = 0;
						d.chocolate.forEach(function(d) {
							d.count = count;
							d.offset = runningTotal2;
							d.offset2 = runningTotal3;
							d.barheight = Math.max(2,Math.round(d.number*scale));
							d.barheight2 = Math.max(2,Math.round(d.number*scale2));
							runningTotal2 += d.barheight;
							runningTotal3 += d.barheight2;
						});
						count++;
					});
					filterSVG = d3.select("#filterSVG");
					techniques = filterSVG
						.selectAll("g")
						.data(data.techniques)
						.enter()
						.append("g")
						.attr("transform", function(d,i) { 
							return "translate(50,"+ (405 - (d.offset + 2*i)) +")";
						})
						.attr("class","filterGroup")
					;
					techniques
						.append("text")
						.attr("class", function(d,i) {
							if(i==0){
								return "filterLabel big";
							} else {
								return "filterLabel";
							}
						})
						.attr("transform", function(d,i) { 
							if(i==0){
								return "translate(300,"+ (d.offset - 13*i) +")";
							}else{
								return "translate(300,"+ (d.offset - (13*i + 4)) +")";
							}
						})
						.text(function(d,i) { 
							return d.name + " (" + d.number + ")";
						})
					;
					techniques
						.append("line")
						.attr("class", "filterLine")
						.attr("x1", 82)
						.attr("y1", function(d,i) { 
							return -d.barheight/2;
						})
						.attr("x2", 298)
						.attr("y2", function(d,i) { 
							return (d.offset - (13*i + 4));
						})
					;
					techniques
						.selectAll("rect")
						.data(function(d) {
							console.log(d); 
							return d.chocolate; 
						})
						.enter()
						.append("rect")
						.attr("class", "filterRect")
						.attr("width", 80)
						.attr("height", function(d) { 
							return d.barheight; 
						})
						.attr("x", 0)
						.attr("y", function(d) { 
							return -d.offset-d.barheight;
						})
					;
					var chocolate = techniques
						.append("g")
					;
					chocolate
						.selectAll("line")
						.data(function(d) {
							return d.chocolate; 
						})
						.enter()
						.append("line")
						.attr("class", "filterLine2")
						.attr("opacity", 0)
						.attr("x1", 82)
						.attr("y1", function(d,i) { 
							return 0-(d.offset2+d.barheight2/2+2*i);
						})
						.attr("x2", 298)
						.attr("y2", function(d,i) { 
							return 0-(15*i + 4);
						})
					;
					chocolate
						.selectAll("text")
						.data(function(d) {
							return d.chocolate; 
						})
						.enter()
						.append("text")
						.attr("class", function(d,i) {
							if(i==0){
								return "filterLabel2 big";
							} else {
								return "filterLabel2";
							}
						})
						.attr("opacity", 0)
						.attr("transform", function(d,i) { 
							if(i==0){
								return "translate(300,0)";
							}else{
								return "translate(300,"+ (-4-(15*i)) +")";
							}
						})
						.text(function(d,i) { 
							return d.type + " (" + d.number + ")";
						})
					;
				});  
			}

			function updateFilterChart(i){
				var transFilter = d3.select("#filterContainer").transition();
				filterSVG = d3.select("#filterSVG");
				if(i==1){
					transFilter
						.duration(750)
						.selectAll(".filterGroup")
						.attr("transform", function(d,i) { 
							return "translate(50,"+ (400 - (d.offset + 400*i)) +")";
						})
					;
					transFilter
						.delay(750)
						.selectAll("h2")
						.text("Chocolate Content")
					;
					transFilter
						.delay(750)
						.duration(750)
						.selectAll(".filterRect")
						.attr("height", function(d) { 
							return d.barheight2; 
						})
						.attr("y", function(d,i) { 
							return -(d.offset2+d.barheight2+i*2);
						})
					;
					transFilter
						.delay(750)
						.selectAll(".filterLine")
						.attr("opacity", 0)
					;
					transFilter
						.delay(750)
						.selectAll(".filterLabel")
						.attr("opacity", 0)
					;
					transFilter
						.delay(1500)
						.selectAll(".filterLine2")
						.attr("opacity", 1)
					;
					transFilter
						.delay(1500)
						.selectAll(".filterLabel2")
						.attr("opacity", 1)
					;

				}else if(i==0){
					transFilter
						.delay(1500)
						.duration(750)
						.selectAll(".filterGroup")
						.attr("transform", function(d,i) { 
							return "translate(50,"+ (405 - (d.offset + 2*i)) +")";
						})
					;
					transFilter
						.delay(750)
						.selectAll("h2")
						.text("Cooking Techniques")
					;
					transFilter
						.duration(750)
						.selectAll(".filterRect")
						.attr("height", function(d) { 
							return d.barheight; 
						})
						.attr("y", function(d,i) { 
							return -(d.offset+d.barheight);
						})
					;
					transFilter
						.delay(750)
						.selectAll(".filterLine")
						.attr("opacity", 1)
					;
					transFilter
						.delay(750)
						.selectAll(".filterLabel")
						.attr("opacity", 1)
					;
					transFilter
						.selectAll(".filterLine2")
						.attr("opacity", 0)
					;
					transFilter
						.selectAll(".filterLabel2")
						.attr("opacity", 0)
					;
				}
			}


   			drawFilterChart();



		</script>
	</body>
</html>

