<!DOCTYPE html>
<html lang="en-us" ng-app="andybarefoot">
    <head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<meta name="viewport" content="initial-scale=1.0, width=device-width" />		
		<title>Andy Barefoot | Data Visualisation</title>
		<meta charset="utf-8" />
		<link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
		<link rel="stylesheet" href="/css/reset.css">
		<link rel="stylesheet" href="main.css">
		<script src="/jscript/d3v4+jetpack.js"></script>
		<script src="/jscript/graph-scroll.js"></script>
		<script src="/jscript/analyticstracking.js"></script>
    </head>
    <body>
		<script>
			var currentVis = 0;
			function spinCircles() {
				d3
					.selectAll(".circleSpin")
					.transition()
					.duration(2000)
				    .attrTween("transform", function(d,i) {
				        var center = "0,0";
						return d3.interpolateString("rotate(0," + center + ")", "rotate(" + 90 * Math.pow(-1, i) + "," + center + ")");
				        })
			        .ease(d3.easeLinear)
					.on("end", spinCircles)
	    		;
		    } 

			//Load in datavis data
			d3.json("datavis.json", function(data) {
				// create HTML content
				everything = d3.select("body")
					.append("div")
					.attr("id", "everything")
				;
				content = everything
					.append("div")
					.attr("id", "content")
					.attr("class", "content")
				;
				intro = content
					.append("div")
					.attr("id", "intro")
					.attr("class","intro")
				;
				intro
					.append("h1")
					.text(data.title)
				;
				intro
					.append("div")
					.html(data.desc)
				;
				visdesc = content
					.selectAll(".visdesc")
					.data(data.datavis)
					.enter()
					.append("div")
					.attr("class", "visdesc")
				;
				visdesc
					.append("h3")
					.text(function(d){ 
						return d.vistype;
					})
				;
				visdesc
					.append("h2")
					.text(function(d){ 
						return d.title;
					})
				;
				visdesc
					.append("div")
					.html(function(d){ 
						return d.visDesc;
					})
				;
				// CREATE VIS CONTENT
				baseSVG = everything
					.append("div")
					.attr("id", "graphics")
					.append("svg")
					.attr("id", "baseSVG")
				;
				fixedSVG = baseSVG
					.append("svg")
					.attr("id", "fixedSVG")
					.attr("viewBox", "0 0 1600 900")
					.attr("preserveAspectRatio", "xMinYMin meet")
				;
				stretchSVG = baseSVG
					.append("svg")
					.attr("id", "fixedSVG")
					.attr("viewBox", "0 0 1600 900")
					.attr("preserveAspectRatio", "none")
				;
				// fixedSVG
				// 	.append("rect")
				// 	.attr("width", 1600)
				// 	.attr("height", 900)
				// 	.attr("fill", "none")
				// 	.attr("stroke", "green")
				// ;
				// stretchSVG
				// 	.append("rect")
				// 	.attr("width", 1599)
				// 	.attr("height", 899)
				// 	.attr("fill", "none")
				// 	.attr("stroke", "blue")
				// 	.attr("stroke-width", 4)
				// ;
				fixedGroup = fixedSVG
					.append("g")
					.attr("id", "fixedGroup")
					.attr("transform", "translate(0,0)")
				;
				var defs = fixedSVG
					.append("defs")
				;
				// add patterns for each circle image
				defs
					.selectAll("pattern")
					.data(data.datavis)
					.enter()
					.append("pattern")
					.attr("id",function(d,i) { return "mainImage"+i; })
					.attr("patternContentUnits","objectBoundingBox")
					.attr("height","100%")
					.attr("width","100%")
					.append("image")
					.attr("height","1")
					.attr("width","1")
					.attr("xlink:href",function(d) { 
						return d.mainImage;
					})
				;
				radius = 65;
				circles = fixedGroup
					.selectAll("g")
					.data(data.datavis)
					.enter()
					.append("g")
					.attr("id", function(d,i){ 
						return "circleGroup"+i;
					})
					.attr("class", "circleGroup")
					.attr("transform",function(d,i){ 
						return "translate("+(130+i*30+(i%2)*500)+","+(120 + i*80)+")" ;
					})
				;
				circles
					.append("text")
					.attr("x", function(d,i){ 
						if(i%2==0){
							return 70;
						}else{
							return -70;
						}
					})
					.attr("y", -27)
					.attr("dy", 0)
					.attr("class", "circleType")
					.attr("id", function(d,i){ 
						return "circleType"+i;
					})
					.attr("text-anchor", function(d,i){ 
						if(i%2==0){
							return "start";
						}else{
							return "end";
						}
					})
					.text(function(d,i){ 
						return d.vistype;
					})
				;
				circles
					.append("text")
					.attr("x", function(d,i){ 
						if(i%2==0){
							return 70;
						}else{
							return -70;
						}
					})
					.attr("y", -5)
					.attr("dy", 0)
					.attr("class", "circleTitle")
					.attr("id", function(d,i){ 
						return "circleTitle"+i;
					})
					.attr("text-anchor", function(d,i){ 
						if(i%2==0){
							return "start";
						}else{
							return "end";
						}
					})
					.text(function(d,i){ 
						return d.title;
					})
				;
				viscircle = circles
					.append("circle")
					.attr("class", "circleSpin")
					.attr("id", "circle")
					.attr("r", radius)
					.attr("stroke-width", 1)
					.attr("stroke", "black")
					.attr("stroke-dasharray", function(){
						// distance 1 degree around perimeter
						degPer = Math.PI * 2*radius/360;
						return 10*degPer+","+5*degPer;
					})
					.attr("fill", "none")
				;
				viscircle = circles
					.append("circle")
					.attr("class", "circleStatic")
					.attr("id", function(d,i){ 
						return "circle"+i;
					})
					.attr("r", radius-5)
					.attr("stroke-width", 1)
					.attr("stroke", "black")
					.attr("fill", "none")
					.attr("transform", "rotate(270)")
					.attr("stroke-dasharray", "0,"+2*Math.PI*(radius-5))
				;
				viscircle = circles
					.append("circle")
					.attr("class", "circleImage")
					.attr("id", function(d,i){ 
						return "circle"+i;
					})
					.attr("r", radius-7)
					.attr("stroke", "none")
					.attr("fill", function(d,i) {
						return "url(#mainImage"+i+")";
					})
					.style("opacity", 0);
				;
 				d3.selectAll(".circleStatic").transition().delay(function(d,i){ return i*500;}).duration(500).attr("stroke-dasharray", 2*Math.PI*(radius-5)+",0");
 				d3.selectAll(".circleImage").transition().delay(function(d,i){ return 500+i*500;}).style("opacity", 1);
 				setTimeout(function(){
	 				d3.selectAll(".circleGroup").classed("showSpin", true);
				}, 4500);
				spinCircles();

				var scroll = d3.graphScroll()
					.container(d3.select('#everything'))
					.graph(d3.select('#graphics'))
					.sections(d3.selectAll('.visdesc'))
					.on('active', function(i){
						currentVis = i;
						for(x=0;x<circles.size();x++){
							if(i==0){
								d3.select("#circleType"+x).transition().delay(2000).attr("class","circleType");
								d3.select("#circleTitle"+x).transition().delay(2000).attr("class","circleTitle");
								d3.select("#circleTitle"+x).attr("y",-5);
								d3.select("#circleGroup"+x).transition().duration(2000).attr("transform","translate("+(130+x*30+(x%2)*500)+","+(120 + x*80)+") scale(1)");
							}else if((x+1)==i){
								d3.select("#circleType"+x).attr("class","typeHidden");
								d3.select("#circleTitle"+x).attr("class","typeHidden");
								d3.select("#circleTitle"+x).transition().duration(2000).attr("y",-5);
								d3.select("#circleGroup"+x).transition().duration(2000).attr("transform","translate(300,"+ (120+(80*x)) +") scale(1)");
							}else{
								d3.select("#circleType"+x).attr("class","typeHidden");
								d3.select("#circleTitle"+x).transition().delay(2000).attr("class","circleTitle");
								d3.select("#circleTitle"+x).attr("y",5);
								if((x+1)<i){
									d3.select("#circleGroup"+x).transition().duration(2000).attr("transform","translate("+(80+(x%2)*200)+","+(80 + x*50)+") scale(0.5)");
								}else{
									d3.select("#circleGroup"+x).transition().duration(2000).attr("transform","translate("+(80+(x%2)*200)+","+(420 + x*50)+") scale(0.5)");
								}
							}
						}
					})
				;

			})


		</script>
	</body>
</html>


